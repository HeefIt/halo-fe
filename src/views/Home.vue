3<!--
  Home é¦–é¡µç»„ä»¶
  åŠŸèƒ½æè¿°ï¼šåº”ç”¨é¦–é¡µï¼Œç™»å½•åçš„æ¬¢è¿é¡µé¢
  ä¸»è¦åŠŸèƒ½ï¼š
    - æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    - æä¾›å››ä¸ªåŠŸèƒ½å¯¼èˆªå¡ç‰‡ï¼ˆé¢˜åº“ç»ƒä¹ ã€å­¦ä¹ è®¡åˆ’ã€æ’è¡Œæ¦œã€æˆ‘çš„ç»ƒä¹ ï¼‰
    - å±•ç¤ºä»Šæ—¥åˆ·é¢˜ç»Ÿè®¡ä¿¡æ¯ï¼ˆåˆ·é¢˜æ•°ã€è€—æ—¶ã€æ­£ç¡®ç‡ã€å¾—åˆ†ï¼‰
    - è‡ªåŠ¨åŠ è½½æ¯æ—¥ç»Ÿè®¡æ•°æ®
  ä½¿ç”¨ä½ç½®ï¼šè·¯ç”± /home
-->
<template>
  <div class="home-page">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <Header />
    
    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
      <div class="container">
        <div class="welcome-section">
          <h1 class="welcome-title">æ¬¢è¿æ¥åˆ° Halo åˆ·é¢˜ç½‘</h1>
          <p class="welcome-subtitle">é€‰æ‹©ä¸€ä¸ªåŠŸèƒ½å¼€å§‹æ‚¨çš„å­¦ä¹ ä¹‹æ—…</p>
        </div>
        
        <!-- åŠŸèƒ½å¯¼èˆªç½‘æ ¼ -->
        <div class="features-grid">
          <el-row :gutter="30">
            <el-col :span="12" :md="6">
              <div class="feature-card" @click="goTo('/home/questions')">
                <div class="feature-icon">
                  <el-icon><Collection /></el-icon>
                </div>
                <h3 class="feature-title">é¢˜åº“ç»ƒä¹ </h3>
                <p class="feature-description">æµ·é‡é¢˜ç›®éšæ—¶ç»ƒä¹ </p>
              </div>
            </el-col>
            <el-col :span="12" :md="6">
              <div class="feature-card" @click="goTo('/study-plan')">
                <div class="feature-icon">
                  <el-icon><Calendar /></el-icon>
                </div>
                <h3 class="feature-title">å­¦ä¹ è®¡åˆ’</h3>
                <p class="feature-description">åˆ¶å®šä¸“å±å­¦ä¹ è®¡åˆ’</p>
              </div>
            </el-col>
            <el-col :span="12" :md="6">
              <div class="feature-card" @click="goTo('/ranking')">
                <div class="feature-icon">
                  <el-icon><Trophy /></el-icon>
                </div>
                <h3 class="feature-title">æ’è¡Œæ¦œ</h3>
                <p class="feature-description">æŸ¥çœ‹å­¦ä¹ æ’å</p>
              </div>
            </el-col>
            <el-col :span="12" :md="6">
              <div class="feature-card" @click="goTo('/practice-history')">
                <div class="feature-icon">
                  <el-icon><Document /></el-icon>
                </div>
                <h3 class="feature-title">æˆ‘çš„ç»ƒä¹ </h3>
                <p class="feature-description">æŸ¥çœ‹ç»ƒä¹ å†å²è®°å½•</p>
              </div>
            </el-col>
          </el-row>
        </div>
        
        <!-- AIæ™ºèƒ½åŠ©æ‰‹åŒºåŸŸ -->
        <div class="ai-section">
          <div class="section-header">
            <h2 class="section-title">ğŸ¤– AI æ™ºèƒ½åŠ©æ‰‹</h2>
            <p class="section-subtitle">æ™ºèƒ½AIèµ‹èƒ½ï¼Œæå‡å­¦ä¹ æ•ˆç‡</p>
          </div>
          
          <div class="ai-grid">
            <div class="ai-card" @click="goTo('/ai/chatbot')" role="button" tabindex="0">
              <div class="ai-card-header">
                <div class="ai-icon">ğŸ’¬</div>
                <span class="ai-badge">HOT</span>
              </div>
              <h3 class="ai-title">æœºå™¨äººå¯¹è¯</h3>
              <p class="ai-description">æ”¯æŒä¼šè¯è®°å¿†å’Œå†å²ä¼šè¯ï¼Œæ™ºèƒ½é—®ç­”å¯¹è¯</p>
              <div class="ai-arrow">â†’</div>
            </div>
            
            <div class="ai-card" @click="goTo('/ai/practice-assistant')" role="button" tabindex="0">
              <div class="ai-card-header">
                <div class="ai-icon">ğŸ“</div>
                <span class="ai-badge">NEW</span>
              </div>
              <h3 class="ai-title">åˆ·é¢˜åŠ©æ‰‹</h3>
              <p class="ai-description">æ™ºèƒ½æ¨èé¢˜ç›®ï¼Œä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®</p>
              <div class="ai-arrow">â†’</div>
            </div>
            
            <div class="ai-card" @click="goTo('/ai/customer-service')" role="button" tabindex="0">
              <div class="ai-card-header">
                <div class="ai-icon">ğŸ§</div>
                <span class="ai-badge">24/7</span>
              </div>
              <h3 class="ai-title">æ™ºèƒ½å®¢æœ</h3>
              <p class="ai-description">7x24å°æ—¶æ™ºèƒ½å®¢æœï¼Œå¿«é€Ÿè§£ç­”ç–‘é—®</p>
              <div class="ai-arrow">â†’</div>
            </div>
            
            <div class="ai-card" @click="goTo('/ai/multimodal')" role="button" tabindex="0">
              <div class="ai-card-header">
                <div class="ai-icon">ğŸ“„</div>
                <span class="ai-badge">PRO</span>
              </div>
              <h3 class="ai-title">å¤šæ¨¡æ€è§£æ</h3>
              <p class="ai-description">æ”¯æŒPDFã€å›¾ç‰‡ç­‰å¤šæ¨¡æ€æ–‡ä»¶æ™ºèƒ½è§£æ</p>
              <div class="ai-arrow">â†’</div>
            </div>
          </div>
        </div>
        
        <!-- æ¯æ—¥ç»Ÿè®¡ -->
        <el-card class="stats-card">
          <template #header>
            <div class="stats-header">
              <span>ä»Šæ—¥åˆ·é¢˜ç»Ÿè®¡ (æ¯æ—¥å‡Œæ™¨1ç‚¹ç»“ç®—)</span>
            </div>
          </template>
          
          <div class="stats-content">
            <el-skeleton :loading="dailyStatsLoading" animated>
              <template #template>
                <el-row :gutter="20">
                  <el-col :span="6">
                    <div class="stat-skeleton">
                      <el-skeleton-item variant="text" style="width: 60%; height: 20px; margin-bottom: 8px;" />
                      <el-skeleton-item variant="text" style="width: 80%; height: 16px;" />
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-skeleton">
                      <el-skeleton-item variant="text" style="width: 60%; height: 20px; margin-bottom: 8px;" />
                      <el-skeleton-item variant="text" style="width: 80%; height: 16px;" />
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-skeleton">
                      <el-skeleton-item variant="text" style="width: 60%; height: 20px; margin-bottom: 8px;" />
                      <el-skeleton-item variant="text" style="width: 80%; height: 16px;" />
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-skeleton">
                      <el-skeleton-item variant="text" style="width: 60%; height: 20px; margin-bottom: 8px;" />
                      <el-skeleton-item variant="text" style="width: 80%; height: 16px;" />
                    </div>
                  </el-col>
                </el-row>
              </template>
              <template #default>
                <el-row :gutter="20">
                  <el-col :span="6">
                    <div class="stat-item">
                      <div class="stat-label">åˆ·é¢˜æ•°</div>
                      <div class="stat-value">{{ dailyStats.problemCount }}</div>
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-item">
                      <div class="stat-label">åˆ·é¢˜æ—¶é—´</div>
                      <div class="stat-value">{{ formatTime(dailyStats.totalTime) }}</div>
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-item">
                      <div class="stat-label">æ­£ç¡®ç‡</div>
                      <div class="stat-value">{{ dailyStats.accuracy }}%</div>
                    </div>
                  </el-col>
                  <el-col :span="6">
                    <div class="stat-item">
                      <div class="stat-label">ä»Šæ—¥å¾—åˆ†</div>
                      <div class="stat-value">{{ dailyStats.totalScore }}</div>
                    </div>
                  </el-col>
                </el-row>
              </template>
            </el-skeleton>
          </div>
        </el-card>
      </div>
    </main>
  </div>
</template>

<script setup>
import { ref, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import { useUserStore } from '@/stores/user'
import { getDailyStatistics } from '@/api/subject'
import { Collection, Calendar, Trophy, Document } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import Header from '@/views/components/layout/Header.vue'

const router = useRouter()
const userStore = useUserStore()

// åŠ è½½çŠ¶æ€
const dailyStatsLoading = ref(false)

// æ¯æ—¥ç»Ÿè®¡ä¿¡æ¯
const dailyStats = ref({
  problemCount: 0,
  totalTime: 0,
  accuracy: 0.0,
  totalScore: 0
})

// è·³è½¬åˆ°æŒ‡å®šè·¯å¾„
const goTo = (path) => {
  console.log('è·³è½¬åˆ°:', path)
  console.log('å½“å‰ç”¨æˆ·ç™»å½•çŠ¶æ€:', userStore.isLoggedIn)
  
  if (!userStore.isLoggedIn) {
    ElMessage.warning('è¯·å…ˆç™»å½•åå†ä½¿ç”¨AIåŠŸèƒ½')
    router.push('/login')
    return
  }
  
  router.push(path).catch(err => {
    console.error('è·¯ç”±è·³è½¬å¤±è´¥:', err)
    ElMessage.error('é¡µé¢è·³è½¬å¤±è´¥: ' + err.message)
  })
}

// è·å–æ¯æ—¥ç»Ÿè®¡ä¿¡æ¯
const fetchDailyStatistics = async () => {
  dailyStatsLoading.value = true
  try {
    const res = await getDailyStatistics(userStore.userInfo.id)
    if (res.code === 200) {
      dailyStats.value = res.data
    } else {
      ElMessage.error(res.message || 'è·å–æ¯æ—¥ç»Ÿè®¡ä¿¡æ¯å¤±è´¥')
    }
  } catch (err) {
    ElMessage.error('è·å–æ¯æ—¥ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ' + err.message)
  } finally {
    dailyStatsLoading.value = false
  }
}

// æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
const formatTime = (seconds) => {
  if (!seconds) return '0ç§’'
  
  const hours = Math.floor(seconds / 3600)
  const minutes = Math.floor((seconds % 3600) / 60)
  const remainingSeconds = seconds % 60
  
  let result = ''
  if (hours > 0) {
    result += `${hours}å°æ—¶`
  }
  if (minutes > 0) {
    result += `${minutes}åˆ†é’Ÿ`
  }
  if (remainingSeconds > 0 || result === '') {
    result += `${remainingSeconds}ç§’`
  }
  
  return result
}

// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–æ•°æ®
onMounted(async () => {
  await fetchDailyStatistics()
})

// ç›‘å¬ç”¨æˆ·ä¿¡æ¯å˜åŒ–ï¼Œé‡æ–°è·å–æ¯æ—¥ç»Ÿè®¡ä¿¡æ¯
watch(() => userStore.userInfo, (newUserInfo) => {
  if (newUserInfo && newUserInfo.id) {
    fetchDailyStatistics()
  }
}, { immediate: false })
</script>

<style scoped>
.home-page {
  min-height: 100vh;
  background-color: var(--background-color);
}

/* ä¸»å†…å®¹åŒº */
.main-content {
  padding: 88px 24px 24px 24px;
  margin-top: 0;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
}

.welcome-section {
  text-align: center;
  margin-bottom: 40px;
}

.welcome-title {
  font-size: 32px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 16px;
}

.welcome-subtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin: 0;
}

.features-grid {
  margin-bottom: 40px;
}

.feature-card {
  background: white;
  border-radius: 12px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--border-color);
  height: 100%;
}

.feature-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  border-color: var(--primary-color);
}

.feature-icon {
  font-size: 48px;
  color: var(--primary-color);
  margin-bottom: 20px;
}

.feature-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 12px;
}

.feature-description {
  font-size: 14px;
  color: var(--text-secondary);
  margin: 0;
}

/* AI æ™ºèƒ½åŠ©æ‰‹åŒºåŸŸ */
.ai-section {
  margin-bottom: 60px;
}

.section-header {
  text-align: center;
  margin-bottom: 32px;
}

.section-title {
  font-size: 32px;
  font-weight: 700;
  color: #000000;
  margin-bottom: 12px;
  text-transform: uppercase;
  font-family: 'Courier New', monospace;
  letter-spacing: 2px;
}

.section-subtitle {
  font-size: 16px;
  color: #666666;
  margin: 0;
  font-family: 'Courier New', monospace;
}

.ai-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

.ai-card {
  position: relative;
  background: #ffffff;
  border: 4px solid #000000;
  padding: 24px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 8px 8px 0px #000000;
  font-family: 'Courier New', monospace;
  z-index: 1;
  pointer-events: auto;
}

.ai-card:hover {
  transform: translate(-4px, -4px);
  box-shadow: 12px 12px 0px #000000;
  background: #f0f0f0;
}

.ai-card:active {
  transform: translate(0, 0);
  box-shadow: 8px 8px 0px #000000;
}

.ai-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.ai-icon {
  font-size: 40px;
  filter: drop-shadow(2px 2px 0px #000000);
}

.ai-badge {
  background: #e94560;
  color: #ffffff;
  font-size: 10px;
  font-weight: bold;
  padding: 4px 8px;
  border: 2px solid #000000;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.ai-title {
  font-size: 18px;
  font-weight: 700;
  color: #000000;
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.ai-description {
  font-size: 12px;
  color: #666666;
  margin: 0 0 16px 0;
  line-height: 1.6;
}

.ai-arrow {
  position: absolute;
  right: 20px;
  bottom: 20px;
  font-size: 24px;
  color: #e94560;
  font-weight: bold;
  transition: transform 0.2s ease;
}

.ai-card:hover .ai-arrow {
  transform: translateX(4px);
}

.stats-card {
  border-radius: 12px;
}

.stats-header {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

.stat-item {
  text-align: center;
  padding: 20px 0;
}

.stat-label {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: var(--primary-color);
}

.stat-skeleton {
  padding: 20px 0;
}

@media (max-width: 768px) {
  .welcome-title {
    font-size: 24px;
  }
  
  .welcome-subtitle {
    font-size: 16px;
  }
  
  .feature-card {
    padding: 20px 15px;
  }
  
  .feature-icon {
    font-size: 36px;
  }
  
  .feature-title {
    font-size: 18px;
  }
  
  .stat-item {
    padding: 15px 0;
  }
  
  .stat-value {
    font-size: 20px;
  }
  
  .section-title {
    font-size: 24px;
  }
  
  .section-subtitle {
    font-size: 14px;
  }
  
  .ai-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  
  .ai-card {
    padding: 16px;
  }
  
  .ai-icon {
    font-size: 32px;
  }
  
  .ai-title {
    font-size: 14px;
  }
  
  .ai-description {
    font-size: 10px;
  }
}
</style>
